generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

model User {
  id                String                 @id @default(cuid())
  email             String                 @unique
  name              String?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  deletedAt         DateTime?
  identityProviders UserIdentityProvider[]
}

model UserIdentityProvider {
  id         String    @id @default(cuid())
  provider   String
  providerId String
  userId     String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime?
  user       User      @relation(fields: [userId], references: [id])
}

/// @DtoCreateOptional
/// @DtoUpdateOptional  
model Calculations {
  /// @DtoReadOnly
  /// @example "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
  id                                       String             @id @default(uuid())
  /// @example "1234567890"  
  bbl                                      String
  /// @example "123 Main Street, Manhattan"  
  address                                  String
  /// @example "Manhattan"
  boro                                     String
  /// @example 1930
  yearBuilt                                Int
  /// @example 6
  stories                                  Int
  /// @example "R4"
  buildingClass                            String
  /// @example 10000.0
  totalSquareFeet                          Float
  /// @example 10
  totalResidentialUnits                    Int
  /// @example 8
  ptacUnits                                Int
  /// @example true
  isRentStabilized                         Boolean?
  /// @example "{\"studio\": 2, \"one_bed\": 4, \"two_bed\": 3, \"three_plus\": 1}"
  unitMixBreakDown                         String
  /// @example 5.5
  capRate                                  Float
  /// @example 1000000.0
  buildingValue                            Float
  /// @DtoReadOnly
  /// @example 1234.56
  annualBuildingMMBtuCoolingPTAC           Float?
  /// @DtoReadOnly  
  /// @example 2550.00
  annualBuildingMMBtuHeatingPTAC           Float?
  /// @DtoReadOnly
  /// @example 3784.56  
  annualBuildingMMBtuTotalPTAC             Float?
  /// @DtoReadOnly
  /// @example 1200.50
  annualBuildingMMBtuHeatingPTHP           Float?
  /// @DtoReadOnly  
  /// @example 1234.56
  annualBuildingMMBtuCoolingPTHP           Float?
  /// @DtoReadOnly
  /// @example 2435.06
  annualBuildingMMBtuTotalPTHP             Float?
  /// @DtoReadOnly
  /// @example 35.67
  energyReductionPercentage                Float?
  /// @DtoReadOnly
  /// @example 68200.00
  totalRetrofitCost                        Float?
  /// @DtoReadOnly
  /// @example 25500.00
  annualBuildingThermsHeatingPTAC          Float?
  /// @DtoReadOnly
  /// @example 1600  
  annualBuildingkWhCoolingPTAC             Float?
  /// @DtoReadOnly
  /// @example 1600
  annualBuildingkWhCoolingPTHP             Float?
  /// @DtoReadOnly  
  /// @example 77000.00
  annualBuildingCostPTAC                   Float?
  /// @DtoReadOnly
  /// @example 45357.14  
  annualBuildingCostPTHP                   Float?
  /// @DtoReadOnly
  /// @example 31642.86
  annualEnergySavings                      Float?
  /// @DtoReadOnly
  /// @example 738
  eflhHours                                Int?
  /// @DtoReadOnly
  /// @example 145000.50
  annualBuildingkWhHeatingPTHP             Float?
  /// @DtoReadOnly
  /// @example "AI-Assumed"
  unitBreakdownSource                      String?
  /// @DtoReadOnly
  aiAnalysisNotes                          String?
  /// @DtoReadOnly
  /// @example 245.50
  emissionsBudget2024to2029                Float?
  /// @DtoReadOnly
  /// @example 189.25
  emissionsBudget2030to2034                Float?
  /// @DtoReadOnly
  /// @example 69.75
  emissionsBudget2035to2039                Float?
  /// @DtoReadOnly
  /// @example 24.60
  emissionsBudget2040to2049                Float?
  /// @DtoReadOnly
  /// @example 1250.50
  totalBuildingEmissionsLL84               Float?
  /// @DtoReadOnly
  /// @example 268750.00
  annualFeeExceedingBudget2024to2029       Float?
  /// @DtoReadOnly
  /// @example 284250.00
  annualFeeExceedingBudget2030to2034       Float?
  /// @DtoReadOnly
  /// @example 317450.00
  annualFeeExceedingBudget2035to2039       Float?
  /// @DtoReadOnly
  /// @example 328650.00
  annualFeeExceedingBudget2040to2049       Float?
  /// @DtoReadOnly
  /// @example 188.65
  beCreditBefore2027                       Float?
  /// @DtoReadOnly
  /// @example 94.33
  beCredit2027to2029                       Float?
  /// @DtoReadOnly
  /// @example 1195.25
  adjustedTotalBuildingEmissions2024to2029 Float?
  /// @DtoReadOnly
  /// @example 1180.50
  adjustedTotalBuildingEmissions2030to2034 Float?
  /// @DtoReadOnly
  /// @example 1180.50
  adjustedTotalBuildingEmissions2035to2039 Float?
  /// @DtoReadOnly
  /// @example 1180.50
  adjustedTotalBuildingEmissions2040to2049 Float?
  /// @DtoReadOnly
  /// @example 15250.00
  adjustedAnnualFeeBefore2027              Float?
  /// @DtoReadOnly
  /// @example 25450.00
  adjustedAnnualFee2027to2029              Float?
  /// @DtoReadOnly
  /// @example 83650.00
  adjustedAnnualFee2030to2034              Float?
  /// @DtoReadOnly
  /// @example 296750.00
  adjustedAnnualFee2035to2039              Float?
  /// @DtoReadOnly
  /// @example 307950.00
  adjustedAnnualFee2040to2049              Float?
  /// @DtoReadOnly
  /// @example 253500.00
  annualLL97FeeAvoidance2024to2027         Float?
  /// @DtoReadOnly
  /// @example 242800.00
  annualLL97FeeAvoidance2027to2029         Float?
  /// @DtoReadOnly
  /// @example 200600.00
  annualLL97FeeAvoidance2030to2034         Float?
  /// @DtoReadOnly
  /// @example 20700.00
  annualLL97FeeAvoidance2035to2039         Float?
  /// @DtoReadOnly
  /// @example 20700.00
  annualLL97FeeAvoidance2040to2049         Float?
  /// @DtoReadOnly
  /// @example 2037
  simplePaybackPeriod                      Int?
  /// @DtoReadOnly
  cumulativeSavingsByYear                  Json?
  /// @DtoReadOnly
  loanBalanceByYear                        Json?
  /// @DtoReadOnly
  /// @example 4223.50
  monthlyPayment                           Float?
  /// @DtoReadOnly
  /// @example 260235.00
  totalInterestPaid                        Float?
  /// @DtoReadOnly
  /// @example 1200000.00
  annualBuildingNOI                        Float?
  /// @DtoReadOnly
  noiByYearNoUpgrade                       Json?
  /// @DtoReadOnly
  noiByYearWithUpgrade                     Json?
  /// @DtoReadOnly
  /// @example 22500000.00
  propertyValueNoUpgrade                   Float?
  /// @DtoReadOnly
  /// @example 30150000.00
  propertyValueWithUpgrade                 Float?
  /// @DtoReadOnly
  /// @example 7650000.00
  netPropertyValueGain                     Float?
  /// @DtoReadOnly
  propertyValueByYearNoUpgrade             Json?
  /// @DtoReadOnly
  propertyValueByYearWithUpgrade           Json?
  /// @DtoReadOnly
  overriddenFields                         Json?
  /// @DtoReadOnly
  lastCalculatedService                    String?
  /// @DtoReadOnly
  serviceVersions                          Json?
  /// @example {"field1": "value1", "field2": "value2"}
  rawPlutoData                             Json?
  /// @example {"field1": "value1", "field2": "value2"}
  rawLL84Data                              Json?
  /// @DtoReadOnly
  /// @example {"Pre-school/Daycare": 1500.0, "Multifamily Housing": 210278.0, "Parking": 13000.0}
  propertyUseBreakdown                     Json?
  /// @DtoReadOnly
  /// @example {"propertyTypes": [{"type": "Multifamily Housing", "squareFeet": 210278, "limits": {"2024-2029": 0.00675}, "contributions": {"2024-2029": 1419.4}}], "totals": {"2024-2029": 1500.2}}
  emissionsLimitsBreakdown                 Json?
  /// @DtoReadOnly
  createdAt                                DateTime           @default(now())
  /// @DtoReadOnly  
  updatedAt                                DateTime           @updatedAt
  /// @example 0.24
  priceKwhHour                             Float?
  /// @example 1.45
  priceThermHour                           Float?
  /// @example 0.10
  pthpContingency                          Float?
  /// @example 450.00
  pthpInstallationCost                     Float?
  /// @example 1100.00
  pthpUnitCost                             Float?
  users                                    UserCalculations[]

  @@index([bbl])
}

model UserCalculations {
  id            String       @id @default(uuid())
  userId        String
  calculationId String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  calculation   Calculations @relation(fields: [calculationId], references: [id])

  @@unique([userId, calculationId])
}
